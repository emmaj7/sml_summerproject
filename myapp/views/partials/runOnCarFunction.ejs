
<!--
Runs the code on the car itself.
Written by: Mikael Glamheden
Date: 2019-06-27
-->
<script type="text/javascript">
  function postCodeToCar(){
    // Generate JavaScript code and run it.
    window.LoopTrap = 1000;
    Blockly.JavaScript.INFINITE_LOOP_TRAP =
    'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
    var code = Blockly.Python.workspaceToCode(workspace);

    var codeObj = {code:code, id: unique_id};

    //  post code to server.
    var codeObj = {code: code, id: unique_id};
    $.post("/postcode2", codeObj, function(data, status){
      console.log(`${data} and status is ${status}`)
    });
  }
  function runOnCar(){
    getShortestCode();
    var onCar = true;
    // runSimulation(onCar);
    socket.on('connect',function(){
      console.log('Connected');
      console.log('Session id: ' + unique_id); // Unique id for each html page opened.
      if (onCar){
        socket.emit('runCodeOnCar', JSON.stringify({'id': unique_id,
                                                    'goal': goal_coords}));
        console.log('Running code on car');
      }
    });
  }
</script>
